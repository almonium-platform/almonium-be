openapi: 3.0.0
info:
  description: User Service
  version: '1.0'
  title: User Control Service

tags:
  - name: user-controller
    description: User Controller
servers:
  - url: http://localhost:8082

paths:
  /users:
    post:
      tags:
        - user-controller
      summary: Create new user
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUser'
      responses:
        200:
          description: Newly created user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          $ref: 'common-types.yaml#/components/responses/BadRequest'
        500:
          $ref: 'common-types.yaml#/components/responses/InternalServerError'
    put:
      tags:
        - user-controller
      summary: Update user info
      operationId: updateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUser'
      responses:
        200:
          description: Update user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          $ref: 'common-types.yaml#/components/responses/NotFound'
        401:
          $ref: 'common-types.yaml#/components/responses/Unauthorized'
        500:
          $ref: 'common-types.yaml#/components/responses/InternalServerError'
  /users/{email}:
    get:
      tags:
        - user-controller
      summary: Get user by email
      operationId: getUserByEmail
      parameters:
        - in: path
          name: email
          required: true
          schema:
            type: string
      responses:
        200:
          description: User by email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          $ref: 'common-types.yaml#/components/responses/NotFound'
        500:
          $ref: 'common-types.yaml#/components/responses/InternalServerError'

components:
  schemas:
    BaseUser:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 250
        companyId:
          type: integer
          format: int64
      required:
        - name
    NewUser:
      allOf:
        - $ref: '#/components/schemas/BaseUser'
        - type: object
          properties:
            email:
              type: string
              format: email
              minLength: 1
              maxLength: 100
            password:
              $ref: 'common-types.yaml#/components/schemas/StrongPassword'
          required:
            - email
            - password
    UpdateUser:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 250
        password:
          $ref: 'common-types.yaml#/components/schemas/StrongPassword'
      required:
        - name
        - password
    User:
      allOf:
        - $ref: '#/components/schemas/BaseUser'
        - type: object
          properties:
            email:
              type: string
            role:
              $ref: './security-api.yaml#/components/schemas/UserRole'
            registeredDatetime:
              type: string
              format: date-time
